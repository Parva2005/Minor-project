<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid Graph Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Hide the initial mermaid loading message */
        .mermaid>svg {
            display: block;
        }
    </style>
</head>

<body class="bg-slate-900 text-slate-200 p-4 sm:p-8 flex items-center justify-center min-h-screen">
    <div class="container mx-auto max-w-5xl">
        <div class="bg-slate-800 rounded-2xl shadow-xl p-6 sm:p-10 border border-slate-700">
            <header class="text-center mb-8">
                <h1 class="text-3xl sm:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-500">
                    Mermaid Graph Generator
                </h1>
                <p class="mt-2 text-slate-400">
                    Create and explain complex diagrams with the power of Gemini AI.
                </p>
            </header>

            <main>
                <!-- AI Input Section -->
                <div class="mb-6 flex flex-col items-center">
                    <label for="ai-prompt" class="sr-only">Describe your graph</label>
                    <textarea id="ai-prompt" rows="3" class="w-full p-4 bg-slate-700 rounded-xl border border-slate-600 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-colors placeholder-slate-400 text-slate-200" placeholder="Describe the graph you want to create (e.g., 'a flowchart for making coffee')"></textarea>
                    <button id="generate-mermaid-btn" class="mt-4 w-full md:w-auto bg-violet-600 hover:bg-violet-700 text-white font-semibold py-3 px-8 rounded-xl transition-colors shadow-lg">
                        Generate Mermaid Code ✨
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-10">
                    <!-- Mermaid Code Editor -->
                    <div class="flex flex-col">
                        <label for="mermaid-input" class="text-lg font-semibold mb-2">Mermaid Code</label>
                        <textarea id="mermaid-input" rows="15" class="w-full h-full p-4 bg-slate-700 rounded-xl border border-slate-600 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-colors placeholder-slate-400 text-slate-200"
                            placeholder="
graph TD
    A[Start] --> B(Process)
    B --> C{Decision}
    C -->|Yes| D[End]
    C -->|No| B
                            "></textarea>
                        <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 mt-4">
                            <button id="generate-graph-btn" class="w-full bg-emerald-500 hover:bg-emerald-600 text-slate-900 font-semibold py-3 px-6 rounded-xl transition-colors shadow-lg">
                                Generate Graph
                            </button>
                            <button id="explain-code-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-xl transition-colors shadow-lg">
                                Explain Code ✨
                            </button>
                        </div>
                    </div>

                    <!-- Output Section -->
                    <div id="graph-container" class="bg-slate-700 p-6 rounded-xl border border-slate-600 flex items-center justify-center overflow-auto h-full min-h-[300px]">
                        <div id="mermaid-output" class="text-slate-400 text-center flex items-center justify-center flex-col">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-16 h-16 text-slate-500 mb-4">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 16.25h-4.5m4.5 0v-4.5m0 4.5L15 15" />
                            </svg>
                            <p>Your graph will appear here.</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        window.onload = function() {
            const aiPromptInput = document.getElementById('ai-prompt');
            const mermaidInput = document.getElementById('mermaid-input');
            const generateMermaidBtn = document.getElementById('generate-mermaid-btn');
            const generateGraphBtn = document.getElementById('generate-graph-btn');
            const explainCodeBtn = document.getElementById('explain-code-btn');
            const outputContainer = document.getElementById('mermaid-output');

            mermaid.initialize({
                startOnLoad: false,
                theme: 'forest'
            });

            const showStatus = (message, isError = false) => {
                outputContainer.innerHTML = `<p class="text-center ${isError ? 'text-red-400' : 'text-slate-400 animate-pulse'}">${message}</p>`;
            };

            const generateMermaidCode = async () => {
                const prompt = aiPromptInput.value.trim();
                if (!prompt) {
                    showStatus('Please enter a description for the graph.', true);
                    return;
                }
                showStatus('Generating Mermaid code...');

                try {
                    const apiKey = "AIzaSyBDd9T3WVUcGZczLnBp5dnnqrp75BPZNEo";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    
                    const systemPrompt = `You are a helpful assistant that generates Mermaid JS code. Respond only with the Mermaid code block and no other text. Your response must be in a single code block. The code block must start with "mermaid". Examples: "flowchart TD..." or "sequenceDiagram..." or "pie..." Do not include any explanation or additional text before or after the code block.`;
                    const userQuery = `Generate Mermaid JS code for the following request: ${prompt}`;

                    const payload = {
                        contents: [{ parts: [{ text: userQuery }] }],
                        systemInstruction: {
                            parts: [{ text: systemPrompt }]
                        },
                    };

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API error: ${response.status} ${response.statusText}`);
                    }

                    const result = await response.json();
                    const generatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (generatedText) {
                        const code = generatedText.replace(/```mermaid\n|```/g, '').trim();
                        mermaidInput.value = code;
                        showStatus('Code generated. Click "Generate Graph" to render it.');
                    } else {
                        showStatus('Sorry, I could not generate the code. Please try a different prompt.', true);
                    }

                } catch (error) {
                    showStatus(`Error generating code: ${error.message}`, true);
                    console.error("API call failed:", error);
                }
            };
            
            const explainMermaidCode = async () => {
                const code = mermaidInput.value.trim();
                if (!code) {
                    showStatus('Please enter some Mermaid code to explain.', true);
                    return;
                }
                showStatus('Explaining the code...');

                try {
                    const apiKey = "AIzaSyBDd9T3WVUcGZczLnBp5dnnqrp75BPZNEo";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    
                    const systemPrompt = `You are a helpful assistant that explains Mermaid JS code. Provide a clear and concise explanation of what the following Mermaid code does. Focus on the structure, components, and flow of the diagram. Do not include any code or code blocks in your response.`;
                    const userQuery = `Explain the following Mermaid code:\n\n${code}`;

                    const payload = {
                        contents: [{ parts: [{ text: userQuery }] }],
                        systemInstruction: {
                            parts: [{ text: systemPrompt }]
                        },
                    };

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API error: ${response.status} ${response.statusText}`);
                    }

                    const result = await response.json();
                    const generatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (generatedText) {
                        outputContainer.innerHTML = `<div class="p-4 bg-slate-600 rounded-lg whitespace-pre-wrap">${generatedText}</div>`;
                    } else {
                        showStatus('Sorry, I could not explain the code. Please try again.', true);
                    }
                } catch (error) {
                    showStatus(`Error explaining code: ${error.message}`, true);
                    console.error("API call failed:", error);
                }
            };

            const renderGraph = () => {
                const code = mermaidInput.value.trim();
                if (!code) {
                    showStatus('Please enter some Mermaid code.', true);
                    return;
                }

                const graphId = `mermaid-graph-${Date.now()}`;
                
                showStatus('Generating graph...');

                try {
                    mermaid.render(graphId, code).then(({ svg }) => {
                        outputContainer.innerHTML = svg;
                    }).catch(error => {
                        showStatus(`Error rendering graph:<br>${error.message}`, true);
                        console.error("Mermaid render error:", error);
                    });
                } catch (error) {
                    showStatus('Invalid Mermaid code.', true);
                    console.error("Mermaid parse error:", error);
                }
            };

            generateMermaidBtn.addEventListener('click', generateMermaidCode);
            generateGraphBtn.addEventListener('click', renderGraph);
            explainCodeBtn.addEventListener('click', explainMermaidCode);
        };
    </script>
</body>

</html>
